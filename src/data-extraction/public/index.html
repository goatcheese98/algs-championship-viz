<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALGS Tournament Data Extractor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s linear infinite;
            pointer-events: none;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .section h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section p {
            margin-bottom: 20px;
            color: #6c757d;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(108, 117, 125, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(220, 53, 69, 0.3);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .status-indicator.online {
            background: #4CAF50;
        }

        .status-indicator.offline {
            background: #dc3545;
            animation: none;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .queue-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .queue-item:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .queue-item .status {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .queue-item .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .queue-item .status.processing {
            background: #cce5ff;
            color: #004085;
        }

        .queue-item .status.completed {
            background: #d4edda;
            color: #155724;
        }

        .queue-item .status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .queue-item .url {
            font-size: 13px;
            color: #6c757d;
            word-break: break-all;
            margin-bottom: 8px;
        }

        .queue-item .details {
            font-size: 12px;
            color: #6c757d;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #dc3545;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .url-examples {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #004085;
        }

        .url-examples h4 {
            margin-bottom: 10px;
            color: #003d73;
        }

        .url-examples code {
            background: #f1f3f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }

        /* Subsection styling for metadata extraction */
        .subsection {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .subsection h3 {
            margin: 0 0 15px 0;
            color: #343a40;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .subsection .input-group {
            margin-bottom: 0;
        }

        /* Button size variants */
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        /* Special styling for metadata results */
        .metadata-result {
            border: 1px solid #28a745;
            background: #f8fff8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .metadata-result.error {
            border-color: #dc3545;
            background: #fff8f8;
        }

        /* Modal overlay styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ ALGS Tournament Data Extractor</h1>
            <p class="subtitle">Professional data extraction and processing for Apex Legends Global Series</p>
        </div>

        <div class="content">
            
            <div class="section">
                <h2>üîå Server Status</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="value">
                            <span class="status-indicator" id="connectionStatus"></span>
                            <span id="statusText">Connecting...</span>
                        </div>
                        <div class="label">Connection</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="queueLength">-</div>
                        <div class="label">Queue Length</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="scraperStatus">-</div>
                        <div class="label">Scraper Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="processingStatus">-</div>
                        <div class="label">Processing Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="selectedFolderDisplay">-</div>
                        <div class="label">Selected Folder</div>
                    </div>
                </div>
            </div>

            
            <div class="section">
                <h2>üìÅ Folder Management</h2>
                <p>Select or create folders for organizing tournament data in /public directory</p>
                
                <div class="input-group">
                    <button class="btn btn-secondary" onclick="loadFolders()">
                        üìÇ Load Folders
                    </button>
                    <button class="btn btn-primary" onclick="showCreateFolderDialog()" style="margin-left: 10px;">
                        ‚ûï Create New Folder
                    </button>
                </div>

                <div id="foldersList" style="margin-top: 20px;"></div>
                
                <div id="createFolderDialog" style="display: none; margin-top: 20px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                    <h3>üìÅ Create New Folder</h3>
                    <div class="input-group">
                        <label for="newFolderName">Folder Name (letters, numbers, underscore, dash only):</label>
                        <input type="text" id="newFolderName" placeholder="year6champions" 
                               pattern="[a-zA-Z0-9_-]+" 
                               style="width: 200px; padding: 8px; border: 2px solid #ddd; border-radius: 5px;">
                        <button class="btn btn-primary" onclick="createFolder()" style="margin-left: 10px;">
                            ‚úÖ Create
                        </button>
                        <button class="btn btn-secondary" onclick="hideCreateFolderDialog()" style="margin-left: 10px;">
                            ‚ùå Cancel
                        </button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">
                        This will create a folder structure with 'processed' and 'raw' subdirectories.
                    </p>
                </div>
                
                <div id="folderResults" style="margin-top: 15px;"></div>
            </div>

            
            <div class="section">
                <h2>üìä Single URL Processing</h2>
                <p>Process a single tournament URL to extract leaderboard data</p>
                
                <div class="url-examples">
                    <h4>üìù Example URLs:</h4>
                    <p>‚Ä¢ <code>https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-1</code></p>
                    <p>‚Ä¢ <code>https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-2</code></p>
                    <p>‚Ä¢ <code>https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/EliminationRound1-1</code></p>
                    <p>
                        <strong>üí° Tip:</strong> Copy the URL from the tournament page before clicking on any specific game. 
                        The URL should contain the round information but not include specific game numbers.
                    </p>
                </div>

                <div class="input-group">
                    <label for="singleUrl">Tournament URL:</label>
                    <input type="url" id="singleUrl" placeholder="https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-1">
                </div>

                <button class="btn" onclick="processSingleUrl()">
                    üìä Process URL
                </button>
                
                <div id="singleUrlResult" style="margin-top: 20px;"></div>
            </div>

            
            <div class="section">
                <h2>üöÄ Batch Processing</h2>
                <p>Process multiple tournament URLs simultaneously with configurable concurrency</p>
                
                <div class="input-group">
                    <label for="batchUrls">URLs (one per line):</label>
                    <textarea id="batchUrls" rows="8" placeholder="https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-1
https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-2
https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-3"></textarea>
                </div>

                <div class="input-group">
                    <label for="maxConcurrent">Max Concurrent Processes:</label>
                    <input type="number" id="maxConcurrent" min="1" max="5" value="2">
                </div>

                <div style="margin-bottom: 20px;">
                    <button class="btn" onclick="startBatchProcessing()" id="startBatchBtn">
                        üöÄ Start Batch Processing
                    </button>
                    <button class="btn btn-danger" onclick="stopBatchProcessing()" id="stopBatchBtn" disabled>
                        üõë Stop Processing
                    </button>
                </div>

                <div id="batchProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div id="progressText" style="text-align: center; margin-top: 10px;"></div>
                </div>
            </div>

            
            <div class="section">
                
                <p>Rename processed CSV files with day prefixes (Day1, Day2, etc.)</p>
                
                <div class="input-group">
                    <label for="dayPrefixInput">Day Prefix (e.g., Day2, Day3):</label>
                    <input type="text" id="dayPrefixInput" placeholder="Day2" 
                           style="width: 120px; padding: 8px; border: 2px solid #ddd; border-radius: 5px;">
                    <button class="btn btn-secondary" onclick="loadProcessedFiles()" style="margin-left: 10px;">
                        üìÇ Load Files
                    </button>
                </div>

                <div id="fileSelectionContainer" style="display: none; margin-top: 20px;">
                    <h3>Select Files to Rename:</h3>
                    <div style="margin-bottom: 10px;">
                        <button class="btn btn-sm" onclick="selectAllFiles()">‚úÖ Select All</button>
                        <button class="btn btn-sm" onclick="deselectAllFiles()" style="margin-left: 10px;">‚ùå Deselect All</button>
                    </div>
                    <div id="filesList" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #f9f9f9;"></div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-primary" onclick="renameSelectedFiles()">
                            üîÑ Rename Selected Files
                        </button>
                    </div>
                </div>

                <div id="renameResults" style="margin-top: 15px;"></div>
            </div>

            <!-- Metadata Extraction Section -->
            <div class="section">
                <h2>üéÆ Metadata Extraction</h2>
                <p>Extract map rotations and legend ban information from ALGS Replays & Bans pages</p>
                
                
                <div class="subsection">
                    <h3>üìÑ Single URL Extraction</h3>
                    <div class="input-group">
                        <label for="metadataUrlInput">Tournament URL (with #tab_replaysandbans):</label>
                        <input type="url" id="metadataUrlInput" 
                               placeholder="https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-5#tab_replaysandbans"
                               style="width: 500px; padding: 8px; border: 2px solid #ddd; border-radius: 5px;">
                        <button class="btn btn-primary" onclick="extractSingleMetadata()" style="margin-left: 10px;">
                            üéØ Extract Metadata
                        </button>
                    </div>
                    <div id="singleMetadataResults" style="margin-top: 15px;"></div>
                </div>

                
                <div class="subsection">
                    <h3>üìä Batch URL Extraction</h3>
                    <div class="input-group">
                        <label for="batchMetadataUrls">Multiple URLs (one per line):</label>
                        <textarea id="batchMetadataUrls" rows="6" 
                                  placeholder="https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-1#tab_replaysandbans&#10;https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-2#tab_replaysandbans&#10;https://apexlegendsstatus.com/algs/Y5-Split1/ALGS-Open/Global/Day1/WinnersRound1-3#tab_replaysandbans"
                                  style="width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 12px;"></textarea>
                        <button class="btn btn-primary" onclick="extractBatchMetadata()" style="margin-top: 10px;">
                            üöÄ Extract All Metadata
                        </button>
                    </div>
                    <div id="batchMetadataResults" style="margin-top: 15px;"></div>
                </div>

                
                <div class="subsection">
                    <h3>üìã View Existing Metadata</h3>
                    <div class="input-group">
                        <button class="btn btn-secondary" onclick="loadMetadataFiles()">
                            üìÇ Load Metadata Files
                        </button>
                    </div>
                    <div id="metadataFilesList" style="margin-top: 15px;"></div>
                </div>
            </div>

            
            <div class="section">
                <h2>üìã Processing Queue</h2>
                <p>Monitor the current processing queue and individual item status</p>
                
                <button class="btn btn-secondary" onclick="refreshQueue()">
                    üîÑ Refresh Queue
                </button>
                
                <div id="queueContainer" style="margin-top: 20px;">
                    <div class="empty-state">
                        <div class="icon">üìù</div>
                        <p>No items in processing queue</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        let isConnected = false;
        let processingQueue = [];
        let processedFiles = [];
        let selectedFiles = new Set();

        function connectWebSocket() {
        function connectWebSocket() {
            socket = io();
            
            socket.on('connect', () => {
                console.log('‚úÖ Connected to automation server');
                isConnected = true;
                updateConnectionStatus();
                refreshQueue();
            });

            socket.on('disconnect', () => {
                console.log('‚ùå Disconnected from automation server');
                isConnected = false;
                updateConnectionStatus();
            });

            socket.on('status', (data) => {
                updateServerStatus(data);
            });

            socket.on('progress', (data) => {
                updateBatchProgress(data);
            });

            socket.on('state', (data) => {
                updateQueueDisplay(data);
            });

            socket.on('batch-complete', (data) => {
                handleBatchComplete(data);
            });

            socket.on('folder-selected', (data) => {
                updateSelectedFolderDisplay(data.selectedFolder);
                showNotification(`Folder selected: ${data.selectedFolder}`);
            });
        }

        function updateConnectionStatus() {
        function updateConnectionStatus() {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (isConnected) {
                statusIndicator.className = 'status-indicator online';
                statusText.textContent = 'Connected';
            } else {
                statusIndicator.className = 'status-indicator offline';
                statusText.textContent = 'Disconnected';
            }
        }

        function updateServerStatus(data) {
            document.getElementById('queueLength').textContent = data.queueLength || 0;
            document.getElementById('scraperStatus').textContent = data.scraperInitialized ? 'Ready' : 'Not Ready';
            document.getElementById('processingStatus').textContent = data.isProcessing ? 'Processing' : 'Idle';
            
            // Update selected folder display
            if (data.selectedFolder) {
                updateSelectedFolderDisplay(data.selectedFolder);
            }
            
            // Update button states
            const startBtn = document.getElementById('startBatchBtn');
            const stopBtn = document.getElementById('stopBatchBtn');
            
            if (data.isProcessing) {
                startBtn.disabled = true;
                stopBtn.disabled = false;
                startBtn.innerHTML = '<span class="spinner"></span>Processing...';
            } else {
                startBtn.disabled = false;
                stopBtn.disabled = true;
                startBtn.innerHTML = 'üöÄ Start Batch Processing';
            }
        }

        function updateSelectedFolderDisplay(folderName) {
            document.getElementById('selectedFolderDisplay').textContent = folderName || 'None';
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        async function processSingleUrl() {
            const url = document.getElementById('singleUrl').value.trim();
            const resultDiv = document.getElementById('singleUrlResult');
            
            if (!url) {
                showNotification('Please enter a valid URL', 'error');
                return;
            }
            
            resultDiv.innerHTML = '<div class="spinner"></div>Processing URL...';
            
            try {
                const response = await fetch('/api/process-url', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 15px; border-radius: 8px; color: #155724;">
                            <strong>‚úÖ Success!</strong> URL processed successfully.
                            <br><small>Check the processed files directory for output.</small>
                        </div>
                    `;
                    showNotification('URL processed successfully!');
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 8px; color: #721c24;">
                            <strong>‚ùå Error:</strong> ${result.error}
                        </div>
                    `;
                    showNotification('Failed to process URL', 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 8px; color: #721c24;">
                        <strong>‚ùå Error:</strong> ${error.message}
                    </div>
                `;
                showNotification('Network error occurred', 'error');
            }
        }

        async function startBatchProcessing() {
            const urls = document.getElementById('batchUrls').value
                .split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);
            
            const maxConcurrent = parseInt(document.getElementById('maxConcurrent').value) || 2;
            
            if (urls.length === 0) {
                showNotification('Please enter at least one URL', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/start-batch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls, maxConcurrent })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`Batch processing started with ${urls.length} URLs`);
                    document.getElementById('batchProgress').style.display = 'block';
                    refreshQueue();
                } else {
                    showNotification(`Failed to start batch processing: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification('Network error occurred', 'error');
            }
        }

        async function stopBatchProcessing() {
            try {
                const response = await fetch('/api/stop-batch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Batch processing stopped');
                    document.getElementById('batchProgress').style.display = 'none';
                    refreshQueue();
                } else {
                    showNotification(`Failed to stop batch processing: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification('Network error occurred', 'error');
            }
        }

        function updateBatchProgress(data) {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            const percentage = data.total > 0 ? (data.completed / data.total) * 100 : 0;
            
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `${data.completed}/${data.total} completed (${data.failed} failed)`;
        }

        function handleBatchComplete(data) {
            document.getElementById('batchProgress').style.display = 'none';
            
            if (data.success) {
                showNotification('Batch processing completed successfully!');
            } else {
                showNotification(`Batch processing failed: ${data.error}`, 'error');
            }
            
            refreshQueue();
        }

        async function refreshQueue() {
            try {
                const response = await fetch('/api/queue');
                const result = await response.json();
                
                if (result.success) {
                    processingQueue = result.queue || [];
                    updateQueueDisplay({ queue: processingQueue });
                }
            } catch (error) {
                console.error('Failed to refresh queue:', error);
            }
        }

        function updateQueueDisplay(data) {
            const container = document.getElementById('queueContainer');
            const queue = data.queue || processingQueue;
            
            if (queue.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìù</div>
                        <p>No items in processing queue</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            queue.forEach((item, index) => {
                html += `
                    <div class="queue-item">
                        <div class="status ${item.status}">${item.status}</div>
                        <div class="url">${item.url}</div>
                        <div class="details">
                            ID: ${item.id} | Position: ${index + 1}
                            ${item.result ? `| Result: ${item.result.success ? 'Success' : 'Failed'}` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        
        let fileManagementProcessedFiles = [];
        let fileManagementSelectedFiles = new Set();

        async function loadProcessedFiles() {
            try {
                const response = await fetch('/api/list-processed-files');
                const result = await response.json();
                
                if (result.success) {
                    fileManagementProcessedFiles = result.files;
                    fileManagementSelectedFiles.clear();
                    displayProcessedFiles();
                    document.getElementById('fileSelectionContainer').style.display = 'block';
                    
                    console.log(`Loaded ${result.count} processed files`);
                } else {
                    alert('Failed to load processed files: ' + result.error);
                }
            } catch (error) {
                alert('Error loading processed files: ' + error.message);
            }
        }

        function displayProcessedFiles() {
            const filesList = document.getElementById('filesList');
            
            if (fileManagementProcessedFiles.length === 0) {
                filesList.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 20px; color: #666;">
                        <p>üìÅ No CSV files found in processed directory</p>
                    </div>
                `;
                return;
            }

            let html = '';
            fileManagementProcessedFiles.forEach((file, index) => {
                const isSelected = fileManagementSelectedFiles.has(file.name);
                html += `
                    <div class="file-item" style="display: flex; align-items: center; padding: 8px; margin-bottom: 5px; background: ${isSelected ? '#e3f2fd' : '#f9f9f9'}; border-radius: 5px; border-left: 4px solid ${isSelected ? '#2196f3' : '#ddd'};">
                        <input type="checkbox" id="file_${index}" ${isSelected ? 'checked' : ''} 
                               onchange="toggleFileSelection('${file.name}')" 
                               style="margin-right: 10px; cursor: pointer;">
                        <label for="file_${index}" style="flex: 1; cursor: pointer; font-size: 14px; color: #333;">
                            üìÑ ${file.name}
                        </label>
                    </div>
                `;
            });
            
            filesList.innerHTML = html;
        }

        function toggleFileSelection(fileName) {
            if (fileManagementSelectedFiles.has(fileName)) {
                fileManagementSelectedFiles.delete(fileName);
            } else {
                fileManagementSelectedFiles.add(fileName);
            }
            displayProcessedFiles();
        }

        function selectAllFiles() {
            fileManagementSelectedFiles.clear();
            fileManagementProcessedFiles.forEach(file => {
                fileManagementSelectedFiles.add(file.name);
            });
            displayProcessedFiles();
        }

        function deselectAllFiles() {
            fileManagementSelectedFiles.clear();
            displayProcessedFiles();
        }

        async function renameSelectedFiles() {
            const dayPrefix = document.getElementById('dayPrefixInput').value.trim();
            
            if (!dayPrefix) {
                alert('Please enter a day prefix (e.g., Day2, Day3)');
                return;
            }
            
            if (fileManagementSelectedFiles.size === 0) {
                alert('Please select at least one file to rename');
                return;
            }
            
            const confirmMessage = `Are you sure you want to rename ${fileManagementSelectedFiles.size} file(s) with prefix "${dayPrefix}-"?`;
            if (!confirm(confirmMessage)) {
                return;
            }
            
            try {
                const response = await fetch('/api/rename-files-with-prefix', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        dayPrefix: dayPrefix,
                        selectedFiles: Array.from(fileManagementSelectedFiles)
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayRenameResults(result);
                    
                    // Reload the file list to show updated names
                    if (result.successful > 0) {
                        await loadProcessedFiles();
                    }
                } else {
                    alert('Failed to rename files: ' + result.error);
                }
            } catch (error) {
                alert('Error renaming files: ' + error.message);
            }
        }

        function displayRenameResults(result) {
            const resultsContainer = document.getElementById('renameResults');
            
            let html = `
                <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; border-left: 4px solid ${result.successful > 0 ? '#28a745' : '#dc3545'};">
                    <h4 style="margin: 0 0 10px 0; color: #333;">üìù Rename Results</h4>
                    <div style="margin-bottom: 10px;">
                        <strong>Total:</strong> ${result.total} files | 
                        <strong style="color: #28a745;">Successful:</strong> ${result.successful} | 
                        <strong style="color: #dc3545;">Failed:</strong> ${result.failed}
                    </div>
            `;
            
            if (result.renamedFiles.length > 0) {
                html += `
                    <div style="margin-bottom: 10px;">
                        <strong>‚úÖ Successfully Renamed:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                result.renamedFiles.forEach(file => {
                    html += `<li style="font-size: 14px; color: #28a745;">${file.original} ‚Üí ${file.renamed}</li>`;
                });
                html += `</ul></div>`;
            }
            
            if (result.errors.length > 0) {
                html += `
                    <div>
                        <strong>‚ùå Errors:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                result.errors.forEach(error => {
                    html += `<li style="font-size: 14px; color: #dc3545;">${error}</li>`;
                });
                html += `</ul></div>`;
            }
            
            html += `</div>`;
            
            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        // Metadata Extraction Functions
        async function extractSingleMetadata() {
            const urlInput = document.getElementById('metadataUrlInput');
            const url = urlInput.value.trim();

            if (!url) {
                alert('Please enter a tournament URL with #tab_replaysandbans');
                return;
            }

            const resultsContainer = document.getElementById('singleMetadataResults');
            resultsContainer.innerHTML = '<p>üéÆ Extracting metadata...</p>';

            try {
                const response = await fetch('/api/extract-metadata', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                const result = await response.json();

                if (result.success) {
                    displaySingleMetadataResults(result);
                } else {
                    resultsContainer.innerHTML = `<p style="color: #dc3545;">‚ùå Error: ${result.error}</p>`;
                }
            } catch (error) {
                resultsContainer.innerHTML = `<p style="color: #dc3545;">‚ùå Error: ${error.message}</p>`;
            }
        }

        function displaySingleMetadataResults(result) {
            const resultsContainer = document.getElementById('singleMetadataResults');
            const data = result.data;
            const summary = result.summary;
            
            let html = `
                <div style="border: 1px solid #28a745; padding: 15px; border-radius: 8px; background: #f8fff8;">
                    <h4 style="margin: 0 0 15px 0; color: #28a745;">‚úÖ Metadata Extracted Successfully</h4>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>Round:</strong> ${summary.roundName}<br>
                        <strong>Total Games:</strong> ${summary.totalGames}<br>
                        <strong>Maps Found:</strong> ${summary.maps}<br>
                        <strong>Legend Bans:</strong> ${summary.bans}
                    </div>
            `;
            
            // Display map rotation
            if (data.metadata.mapRotation && data.metadata.mapRotation.length > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>üó∫Ô∏è Map Rotation:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                data.metadata.mapRotation.forEach(map => {
                    html += `<li>Game ${map.gameNumber}: ${map.map}</li>`;
                });
                html += `</ul></div>`;
            }
            
            // Display legend bans
            if (data.metadata.legendBans && data.metadata.legendBans.length > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>üö´ Legend Bans:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                data.metadata.legendBans.forEach(ban => {
                    html += `<li>Game ${ban.gameNumber}: ${ban.legend}`;
                    if (ban.logoUrl) {
                        html += ` <img src="${ban.logoUrl}" alt="${ban.legend}" style="width: 16px; height: 16px; vertical-align: middle; margin-left: 5px;">`;
                    }
                    html += `</li>`;
                });
                html += `</ul></div>`;
            }
            
            html += `
                    <div style="font-size: 12px; color: #666;">
                        üíæ Saved to: ${data.savedPath}<br>
                        ‚è±Ô∏è Extracted at: ${new Date().toLocaleString()}
                    </div>
                </div>
            `;

            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        async function extractBatchMetadata() {
            const urlsInput = document.getElementById('batchMetadataUrls');
            const urls = urlsInput.value
                .split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);

            if (urls.length === 0) {
                alert('Please enter at least one URL');
                return;
            }

            const resultsContainer = document.getElementById('batchMetadataResults');
            resultsContainer.innerHTML = `<p>üöÄ Extracting metadata for ${urls.length} URLs...</p>`;

            try {
                const response = await fetch('/api/batch-extract-metadata', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls })
                });
                const result = await response.json();

                displayBatchMetadataResults(result);
            } catch (error) {
                resultsContainer.innerHTML = `<p style="color: #dc3545;">‚ùå Error: ${error.message}</p>`;
            }
        }

        function displayBatchMetadataResults(result) {
            const resultsContainer = document.getElementById('batchMetadataResults');
            const summary = result.summary;
            
            let html = `
                <div style="border: 1px solid ${summary.successful > 0 ? '#28a745' : '#dc3545'}; padding: 15px; border-radius: 8px; background: ${summary.successful > 0 ? '#f8fff8' : '#fff8f8'};">
                    <h4 style="margin: 0 0 15px 0; color: ${summary.successful > 0 ? '#28a745' : '#dc3545'};">
                        üìä Batch Extraction Complete
                    </h4>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>Total URLs:</strong> ${summary.total}<br>
                        <strong>‚úÖ Successful:</strong> ${summary.successful}<br>
                        <strong>‚ùå Failed:</strong> ${summary.failed}
                    </div>
            `;

            if (summary.successful > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>‚úÖ Successfully Processed:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                summary.results.forEach(result => {
                    if (result.success) {
                        html += `<li style="color: #28a745;">${result.summary.roundName} (${result.summary.totalGames} games)</li>`;
                    }
                });
                html += `</ul></div>`;
            }

            if (summary.failed > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>‚ùå Failed to Process:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                summary.errors.forEach(error => {
                    html += `<li style="color: #dc3545;">${error.url}: ${error.error}</li>`;
                });
                html += `</ul></div>`;
            }

            html += `
                    <div style="font-size: 12px; color: #666;">
                        ‚è±Ô∏è Completed at: ${new Date().toLocaleString()}
                    </div>
                </div>
            `;

            resultsContainer.innerHTML = html;
            resultsContainer.style.display = 'block';
        }

        async function loadMetadataFiles() {
            try {
                const response = await fetch('/api/list-metadata-files');
                const result = await response.json();
                
                if (result.success) {
                    displayMetadataFilesList(result);
                } else {
                    alert('Failed to load metadata files: ' + result.error);
                }
            } catch (error) {
                alert('Error loading metadata files: ' + error.message);
            }
        }

        function displayMetadataFilesList(result) {
            const filesList = document.getElementById('metadataFilesList');
            
            if (result.files.length === 0) {
                filesList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                        <p>üìÅ No metadata files found in processed directory</p>
                        <p style="font-size: 12px;">Extract some metadata first using the sections above.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #f9f9f9;">
                    <h4 style="margin: 0 0 15px 0; color: #333;">üìã Existing Metadata Files (${result.files.length})</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            result.files.forEach(file => {
                const isValid = !file.error;
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 8px; background: white; border-radius: 5px; border-left: 4px solid ${isValid ? '#28a745' : '#dc3545'};">
                        <div style="flex: 1;">
                            <div style="font-weight: bold; color: #333;">${file.filename}</div>
                            ${isValid ? `
                                <div style="font-size: 12px; color: #666;">
                                    ${file.roundName} ‚Ä¢ ${file.totalGames} games ‚Ä¢ ${file.maps} maps ‚Ä¢ ${file.bans} bans
                                </div>
                                <div style="font-size: 11px; color: #999;">
                                    ${file.extractedAt ? new Date(file.extractedAt).toLocaleString() : 'Unknown date'}
                                </div>
                            ` : `
                                <div style="font-size: 12px; color: #dc3545;">Error: ${file.error}</div>
                            `}
                        </div>
                        ${isValid ? `
                            <button class="btn btn-sm" onclick="viewMetadataFile('${file.filename}')" style="margin-left: 10px;">
                                üëÅÔ∏è View
                            </button>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;

            filesList.innerHTML = html;
        }

        async function viewMetadataFile(filename) {
            try {
                const response = await fetch(`/api/get-metadata/${filename}`);
                const result = await response.json();
                
                if (result.success) {
                    displayMetadataFileContent(result.metadata, filename);
                } else {
                    alert('Failed to load metadata file: ' + result.error);
                }
            } catch (error) {
                alert('Error loading metadata file: ' + error.message);
            }
        }

        function displayMetadataFileContent(metadata, filename) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 1000; display: flex; 
                align-items: center; justify-content: center;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; padding: 20px; border-radius: 8px; 
                max-width: 80%; max-height: 80%; overflow-y: auto;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">üìÑ ${filename}</h3>
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                            style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                        ‚úñÔ∏è Close
                    </button>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Round:</strong> ${metadata.roundInfo.roundName}<br>
                    <strong>URL:</strong> <a href="${metadata.roundInfo.url}" target="_blank">${metadata.roundInfo.url}</a><br>
                    <strong>Total Games:</strong> ${metadata.roundInfo.totalGames}<br>
                    <strong>Extracted:</strong> ${new Date(metadata.roundInfo.timestamp).toLocaleString()}
                </div>
            `;
            
            if (metadata.mapRotation && metadata.mapRotation.length > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>üó∫Ô∏è Map Rotation:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                metadata.mapRotation.forEach(map => {
                    html += `<li>Game ${map.gameNumber}: ${map.map}</li>`;
                });
                html += `</ul></div>`;
            }
            
            if (metadata.legendBans && metadata.legendBans.length > 0) {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>üö´ Legend Bans:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                `;
                metadata.legendBans.forEach(ban => {
                    html += `<li>Game ${ban.gameNumber}: ${ban.legend}`;
                    if (ban.logoUrl) {
                        html += ` <img src="${ban.logoUrl}" alt="${ban.legend}" style="width: 16px; height: 16px; vertical-align: middle; margin-left: 5px;">`;
                    }
                    html += `</li>`;
                });
                html += `</ul></div>`;
            }
            
            content.innerHTML = html;
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Folder Management Functions
        async function loadFolders() {
            try {
                const response = await fetch('/api/list-folders');
                const result = await response.json();
                
                if (result.success) {
                    displayFoldersList(result);
                } else {
                    alert('Failed to load folders: ' + result.error);
                }
            } catch (error) {
                alert('Error loading folders: ' + error.message);
            }
        }

        function displayFoldersList(result) {
            const foldersListDiv = document.getElementById('foldersList');
            
            if (result.folders.length === 0) {
                foldersListDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">
                        <p>üìÅ No folders found in /public directory</p>
                        <p style="font-size: 12px;">Create a new folder to get started.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; background: #f9f9f9;">
                    <h4 style="margin: 0 0 15px 0; color: #333;">üìÇ Available Folders (${result.folders.length})</h4>
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                        Current: <strong>${result.selectedFolder}</strong> | Click a folder to select it for data processing
                    </p>
                    <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            result.folders.forEach(folder => {
                const isSelected = folder.isSelected;
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: ${isSelected ? '#e8f5e8' : 'white'}; border-radius: 5px; border-left: 4px solid ${isSelected ? '#28a745' : '#ddd'}; cursor: pointer; transition: all 0.2s ease;"
                         onclick="selectFolder('${folder.name}')">
                        <div style="flex: 1;">
                            <div style="font-weight: ${isSelected ? 'bold' : 'normal'}; color: ${isSelected ? '#28a745' : '#333'};">
                                ${isSelected ? 'üéØ' : 'üìÅ'} ${folder.name}
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ${folder.fileCount} files ‚Ä¢ 
                                ${folder.hasProcessed ? '‚úÖ' : '‚ùå'} processed ‚Ä¢ 
                                ${folder.hasRaw ? '‚úÖ' : '‚ùå'} raw
                            </div>
                            <div style="font-size: 11px; color: #999;">
                                Created: ${new Date(folder.created).toLocaleDateString()}
                            </div>
                        </div>
                        ${isSelected ? `
                            <div style="color: #28a745; font-weight: bold; margin-left: 10px;">
                                SELECTED
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;

            foldersListDiv.innerHTML = html;
        }

        async function selectFolder(folderName) {
            try {
                const response = await fetch('/api/select-folder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folderName: folderName })
                });
                const result = await response.json();
                
                if (result.success) {
                    updateSelectedFolderDisplay(result.selectedFolder);
                    showNotification(`Selected folder: ${result.selectedFolder}`);
                    
                    // Refresh the folders list to show the new selection
                    await loadFolders();
                } else {
                    alert('Failed to select folder: ' + result.error);
                }
            } catch (error) {
                alert('Error selecting folder: ' + error.message);
            }
        }

        function showCreateFolderDialog() {
            document.getElementById('createFolderDialog').style.display = 'block';
            document.getElementById('newFolderName').focus();
        }

        function hideCreateFolderDialog() {
            document.getElementById('createFolderDialog').style.display = 'none';
            document.getElementById('newFolderName').value = '';
        }

        async function createFolder() {
            const folderName = document.getElementById('newFolderName').value.trim();
            
            if (!folderName) {
                alert('Please enter a folder name');
                return;
            }
            
            if (!/^[a-zA-Z0-9_-]+$/.test(folderName)) {
                alert('Folder name can only contain letters, numbers, underscores, and dashes');
                return;
            }
            
            try {
                const response = await fetch('/api/create-folder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ folderName: folderName })
                });
                const result = await response.json();
                
                if (result.success) {
                    hideCreateFolderDialog();
                    showNotification(`Created folder: ${result.folderName}`);
                    
                    // Refresh the folders list to show the new folder
                    await loadFolders();
                    
                    // Display success message
                    const resultsDiv = document.getElementById('folderResults');
                    resultsDiv.innerHTML = `
                        <div style="border: 1px solid #28a745; padding: 15px; border-radius: 8px; background: #f8fff8;">
                            <h4 style="margin: 0 0 10px 0; color: #28a745;">‚úÖ Folder Created Successfully</h4>
                            <p>Folder <strong>${result.folderName}</strong> has been created with the following structure:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>üìÅ ${result.folderName}/</li>
                                <li>üìÅ ${result.folderName}/processed/</li>
                                <li>üìÅ ${result.folderName}/raw/</li>
                            </ul>
                            <p style="font-size: 12px; color: #666;">
                                You can now select this folder for data processing operations.
                            </p>
                        </div>
                    `;
                } else {
                    alert('Failed to create folder: ' + result.error);
                }
            } catch (error) {
                alert('Error creating folder: ' + error.message);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            loadFolders();
        });
    </script>
</body>
</html> 